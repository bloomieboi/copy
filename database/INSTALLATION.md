# Инструкция по установке недостающих таблиц

## Проблема
При открытии страниц администрирования появляется ошибка:
```
Fatal error: ... Table 'copypastedb.locations' doesn't exist
```

## Решение

### Вариант 1: Через phpMyAdmin (рекомендуется)

1. **Откройте phpMyAdmin**
   - Для OSPanel: http://localhost/openserver/?panel
   - Или через панель управления OSPanel → Дополнительно → phpMyAdmin

2. **Выберите базу данных**
   - В левой панели выберите `copypasteDB`

3. **Перейдите в раздел SQL**
   - Нажмите на вкладку "SQL" в верхней части страницы

4. **Выполните SQL-скрипт**
   - Откройте файл `database/additional_tables.sql` в текстовом редакторе
   - Скопируйте всё его содержимое (Ctrl+A, Ctrl+C)
   - Вставьте в поле SQL в phpMyAdmin (Ctrl+V)
   - Нажмите кнопку "Пошел" (или "Go")

5. **Проверьте результат**
   - Вы должны увидеть сообщение "Таблицы успешно созданы!"
   - В левой панели должны появиться новые таблицы

6. **Обновите страницу проекта**
   - Вернитесь на страницу с ошибкой и обновите её (F5)
   - Ошибка должна исчезнуть

### Вариант 2: Через командную строку MySQL

```bash
# Перейдите в директорию проекта
cd C:\OSPanel\home\copypaste

# Выполните SQL-скрипт
mysql -u root -p copypasteDB < database/additional_tables.sql
```

### Вариант 3: Через OSPanel Console

1. Откройте OSPanel Console
2. Выполните команду:
```bash
mysql -u root copypasteDB < C:\OSPanel\home\copypaste\database\additional_tables.sql
```

## Создаваемые таблицы

Скрипт создаёт следующие таблицы:

1. **locations** - Точки обслуживания (копицентры)
2. **services** - Услуги с привязкой к локациям
3. **address** - Адреса организации
4. **order_address** - Связь заказов с адресами
5. **order_log** - Журнал действий по заказам
6. **order_file** - Файлы, прикрепленные к заказам
7. **message** - Сообщения чата между клиентом и сотрудником
8. **review** - Отзывы клиентов
9. **discount_card** - Скидочные карты
10. **user_discount_card** - Связь пользователей со скидочными картами
11. **payment_method** - Способы оплаты пользователей
12. **admin_request** - Запросы от сотрудников к администратору

## Тестовые данные

Скрипт также добавляет тестовые данные:

### Локации (3 точки)
- Копицентр на Ленина (г. Москва, ул. Ленина, д. 10)
- Копицентр на Пушкина (г. Москва, ул. Пушкина, д. 25)
- Копицентр на Гагарина (г. Москва, ул. Гагарина, д. 5)

### Адреса (3 адреса)
- Соответствуют адресам локаций

### Услуги (5 услуг)
- Печать документов (A4) - 10 руб.
- Печать документов (A3) - 20 руб.
- Печать на кружках - 500 руб.
- Ксерокопия - 5 руб.
- Ламинирование - 50 руб.

## Проверка установки

После выполнения скрипта проверьте:

1. **В phpMyAdmin**
   - Откройте базу `copypasteDB`
   - Проверьте наличие всех 12 таблиц в левой панели

2. **В проекте**
   - Откройте http://localhost/copypaste/admin/locations.php
   - Вы должны увидеть список из 3 тестовых локаций
   - Ошибок быть не должно

3. **Главная страница**
   - Откройте http://localhost/copypaste/
   - Должны отобразиться 5 услуг в каталоге

## Возможные проблемы

### Ошибка "Access denied"
**Решение:** Убедитесь, что используете правильные данные для входа в MySQL:
- Пользователь: `root`
- Пароль: (обычно пустой в OSPanel)

### Ошибка "Unknown database"
**Решение:** Создайте базу данных вручную:
```sql
CREATE DATABASE IF NOT EXISTS copypasteDB 
CHARACTER SET utf8mb4 
COLLATE utf8mb4_unicode_ci;
```

### Таблицы уже существуют
**Решение:** Скрипт использует `CREATE TABLE IF NOT EXISTS`, поэтому безопасно выполнять его повторно.

### Ошибки внешних ключей
**Решение:** Убедитесь, что основные таблицы существуют:
- `user_` (пользователи)
- `order_` (заказы)
- `status` (статусы)
- `role_` (роли)

Если их нет, сначала выполните основной скрипт создания БД.

## Дополнительная помощь

Если проблема не решена:

1. Проверьте логи ошибок PHP:
   - OSPanel: `C:\OSPanel\logs\PHP_8.x_error.log`

2. Проверьте логи MySQL:
   - OSPanel: `C:\OSPanel\logs\MySQL-8.x_error.log`

3. Убедитесь, что MySQL запущен:
   - Откройте панель управления OSPanel
   - Проверьте статус MySQL (должен быть зелёный)

4. Проверьте параметры подключения:
   - Файл: `config/database.php`
   - Хост: `127.0.1.28`
   - Порт: `3306`
   - База: `copypasteDB`

---

**Важно:** После создания таблиц рекомендуется создать резервную копию базы данных через phpMyAdmin (Экспорт → SQL).
