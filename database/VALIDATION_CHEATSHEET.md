# Шпаргалка по валидации

## Быстрые правила

| Поле | Формат | Пример ✅ | Пример ❌ |
|------|--------|----------|----------|
| **Логин** | `[a-zA-Z0-9_]` макс. 30 | `john_doe` | `иван` (кириллица) |
| **Пароль** | `[a-zA-Z0-9!@#$...]` мин. 3 | `Pass123!` | `Пароль` (кириллица) |
| **Телефон** | `79xxxxxxxxx` (11 цифр) | `79123456789` | `89123456789` (не с 79) |
| **Количество** | `1 до 2147483647` | `100` | `0` или `9999999999` |

## Regex паттерны

```regex
Логин:    ^[a-zA-Z0-9_]+$
Пароль:   ^[a-zA-Z0-9!@#$%^&*()_+\-=\[\]{};:\'"\\|,.<>\/?]+$
Телефон:  ^79\d{9}$
```

## PHP примеры

### Использование функций
```php
require_once 'function/validation.php';

// Валидация
$result = validateLogin($login);
if (!$result['valid']) {
    echo $result['error'];
}

$result = validatePassword($password);
$result = validatePhone($phone);
$result = validateQuantity($quantity);

// Форматирование
$phone = formatPhoneNumber('+7 (912) 345-67-89');  // "79123456789"

// Уникальность
if (!isLoginUnique($pdo, $login)) {
    echo "Логин занят";
}
```

### Inline проверка
```php
if (!preg_match('/^[a-zA-Z0-9_]+$/', $login)) {
    $error = "Только английские буквы, цифры и _";
}

if (!preg_match('/^79\d{9}$/', $phone)) {
    $error = "Формат: 79xxxxxxxxx";
}

if ($quantity < 1 || $quantity > 2147483647) {
    $error = "Количество от 1 до 2 147 483 647";
}
```

## HTML5 атрибуты

```html
<!-- Логин -->
<input type="text" 
       pattern="[a-zA-Z0-9_]+" 
       maxlength="30">

<!-- Пароль -->
<input type="password" 
       minlength="3"
       pattern="[a-zA-Z0-9!@#$%^&*()_+\-=\[\]{};:'\"\\|,.<>\/?]+">

<!-- Телефон -->
<input type="tel" 
       pattern="79[0-9]{9}" 
       maxlength="11">

<!-- Количество -->
<input type="number" 
       min="1" 
       max="2147483647">
```

## JavaScript валидация

```javascript
// Логин
if (!/^[a-zA-Z0-9_]*$/.test(login)) {
    input.setCustomValidity('Только английские буквы, цифры и _');
}

// Пароль
if (password.length > 0 && password.length < 3) {
    input.setCustomValidity('Минимум 3 символа');
}

// Телефон с автоформатированием
let value = phone.replace(/\D/g, '');  // Убрать нецифровые
if (value.length >= 1 && value[0] !== '7') value = '7' + value;
if (value.length >= 2 && value[1] !== '9') value = '79' + value.substring(2);
input.value = value.substring(0, 11);
```

## Типичные ошибки

### ❌ НЕ ДЕЛАЙТЕ ТАК:

```php
// Плохо: разрешает кириллицу
if (strlen($login) > 0) { ... }

// Плохо: не проверяет формат
if ($phone) { ... }

// Плохо: SQL injection
$result = $pdo->query("SELECT * FROM user_ WHERE login = '$login'");
```

### ✅ ДЕЛАЙТЕ ТАК:

```php
// Хорошо: проверяет формат
if (preg_match('/^[a-zA-Z0-9_]+$/', $login)) { ... }

// Хорошо: проверяет формат телефона
if (preg_match('/^79\d{9}$/', $phone)) { ... }

// Хорошо: prepared statement
$stmt = $pdo->prepare("SELECT * FROM user_ WHERE login = ?");
$stmt->execute([$login]);
```

## Сообщения пользователю

### Хорошие сообщения
```
✅ "Логин может содержать только английские буквы, цифры и подчеркивание"
✅ "Номер телефона должен быть в формате 79xxxxxxxxx"
✅ "Пароль должен содержать минимум 3 символа"
```

### Плохие сообщения
```
❌ "Неверный логин"
❌ "Ошибка"
❌ "Неправильный формат"
```

## Контрольный список

- [ ] Regex проверка формата (клиент + сервер)
- [ ] Проверка длины (min/max)
- [ ] Проверка уникальности (логин, телефон)
- [ ] Экранирование вывода (htmlspecialchars)
- [ ] Prepared statements (SQL)
- [ ] Сохранение данных при ошибке (UX)
- [ ] Понятные сообщения об ошибках
- [ ] Tooltips с подсказками
- [ ] Примеры в placeholder

## Быстрая диагностика

**Проблема:** Пользователь не может зарегистрироваться
```
1. Проверить логин: только английские?
2. Проверить телефон: начинается с 79?
3. Проверить пароль: минимум 3 символа?
4. Проверить уникальность в БД
```

**Проблема:** Телефон не принимается
```
1. Формат: 79xxxxxxxxx?
2. Длина: ровно 11 цифр?
3. Начало: 79 (не 7, не 8)?
4. Нет спецсимволов: +, -, (), пробелов?
```

**Проблема:** Превышение лимита количества
```
1. Больше 0?
2. Меньше 2147483647?
3. Целое число?
```
